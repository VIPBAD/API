<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Join Music</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="mobile">
  <header class="topbar">
    <button class="back-btn" onclick="location.href='{{ url_for('home') }}'">←</button>
    <div class="title">Join Music</div>
    <div class="top-actions">⋮</div>
  </header>

  <main class="center-screen">
    <div style="padding:12px;text-align:center">
      <img src="{{ thumb }}" alt="" style="width:96px;height:96px;border-radius:10px;">
      <h2 style="margin:10px 0 6px">{{ title }}</h2>
      <div style="color:var(--muted)">{{ artist }}</div>

      <p style="margin-top:14px">You are about to join the music room. Confirm to open the player and start listening.</p>

      <div style="margin-top:18px;display:flex;gap:10px;justify-content:center;">
        <button onclick="doJoin()" class="join-btn big">Join Now</button>
        <button onclick="location.href='{{ url_for('home') }}'" class="join-btn">Cancel</button>
      </div>

      <div style="margin-top:12px;color:var(--muted);font-size:13px">
        You can join as:
        <div style="margin-top:6px;">
          <input id="username" placeholder="Display name" value="{{ username }}" style="padding:8px;width:70%;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;">
        </div>
      </div>
    </div>
  </main>

  <script>
    function doJoin(){
      const username = encodeURIComponent(document.getElementById('username').value || '');
      const user_id = '{{ user_id or "" }}';
      const avatar = '{{ avatar or "" }}';
      const audio = '{{ audio_url }}';
      const title = '{{ title }}';
      const thumb = '{{ thumb }}';
      const artist = '{{ artist }}';

      // send user to player with provided details; server will store in session as well
      const params = new URLSearchParams({
        audio: audio,
        title: title,
        thumb: thumb,
        artist: artist,
      });
      if (username) params.set('username', username);
      if (user_id) params.set('user_id', user_id);
      if (avatar) params.set('avatar', avatar);

      location.href = '/player?' + params.toString();
    }
  </script>
</body>
</html>
